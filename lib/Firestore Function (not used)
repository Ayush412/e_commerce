const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp(functions.config().firebase);

exports.myNotification = functions.firestore.document(`products`).onCreate(async(snap, context) => {
    var url = snap.data.data().notifimgurl;
    var name = snap.data.data().ProdName;
    var cost = snap.data.data().ProdCost;

    const payload = {notification: {
                image: url,
                title: 'Just arrived!',
                body: `${url} ${name} is now available for just QR. ${cost}! Visit the products section for more details.`
                }
            };
           return await admin.messaging().sendToTopic("e-commerce", payload);

  });